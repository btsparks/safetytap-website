---
import Base from '../layouts/Base.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter(p => p.data.featured)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);
---

<Base
  title="SafetyTAP"
  metaTitle="Hazard Recognition Training That Works | SafetyTAP"
  description="SafetyTAP builds hazard recognition skills in 30 seconds — no app, no training, just a photo and a text. Built for construction crews."
>

  <!-- Section 1: Hero -->
  <section class="relative bg-navy-deep py-28 md:py-36 overflow-hidden text-white">
    <div class="absolute inset-0 bg-gradient-to-br from-navy-deep via-navy to-navy-mid opacity-100 pointer-events-none"></div>
    <div class="absolute -top-32 -right-32 w-[600px] h-[600px] rounded-full bg-teal/10 blur-3xl pointer-events-none"></div>
    <div class="relative z-10 max-w-6xl mx-auto px-6 flex flex-col md:flex-row items-center gap-12">
      <div class="flex-1 max-w-2xl">
        <h1 class="font-display text-5xl md:text-6xl lg:text-7xl font-extrabold leading-[1.05] tracking-tight">Build Hazard Recognition Skills Your Crew Will Actually Use</h1>
        <p class="mt-4 text-lg text-teal font-semibold tracking-wide uppercase">Think. Assess. Proceed.</p>
        <p class="mt-4 text-lg md:text-xl text-white/80 leading-relaxed max-w-lg">In 30 seconds, your crew texts a photo and gets one specific safety observation back — the kind an experienced pro would make on-site. No app, no training, no friction.</p>

        <!-- [PLACEHOLDER — replace with real customer quote] -->
        <div class="mt-6 border-l-2 border-teal/40 pl-4">
          <p class="text-white/60 text-sm italic">"We saw a change in how crews talked about hazards within the first month."</p>
          <p class="text-white/40 text-xs mt-1">— [PLACEHOLDER] Safety Director, Mid-size General Contractor</p>
        </div>

        <div class="flex gap-4 mt-8">
          <a href="#how-it-works"
             class="inline-flex items-center gap-2 bg-teal hover:bg-teal-light
                    text-white font-semibold text-base
                    px-7 py-3.5 rounded-lg
                    shadow-lg shadow-teal/20
                    transition-all duration-200 hover:shadow-xl hover:shadow-teal/30 hover:-translate-y-0.5">
            See a Live Example
          </a>
          <a href="/contact"
             class="inline-flex items-center gap-2
                    border border-white/30 hover:border-white/60
                    text-white/90 hover:text-white font-medium text-base
                    px-7 py-3.5 rounded-lg
                    transition-all duration-200 hover:bg-white/5 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-white/5">
            Request a Demo
          </a>
        </div>
      </div>

      <!-- #1: Animated chat conversation -->
      <div class="flex-1 max-w-sm">
        <div id="chat-demo" class="bg-navy-mid/80 backdrop-blur-sm border border-white/10 border-t-white/20 rounded-2xl shadow-2xl p-4">
          <div class="bg-dark/50 rounded-xl p-4 space-y-3 min-h-[180px]">
            <!-- Worker message -->
            <div id="chat-worker" class="flex justify-end opacity-0 transition-opacity duration-300 ease-in-out">
              <div class="bg-teal/20 text-white/90 rounded-xl rounded-br-sm px-4 py-2 text-sm max-w-[240px]">
                <span id="chat-worker-text"></span><span id="chat-cursor" class="inline-block w-[2px] h-[14px] bg-white/60 ml-0.5 animate-blink align-middle"></span>
              </div>
            </div>
            <!-- Typing indicator -->
            <div id="chat-typing" class="flex justify-start opacity-0 transition-opacity duration-300 ease-in-out">
              <div class="bg-white/10 rounded-xl rounded-bl-sm px-4 py-3">
                <div class="flex gap-1.5">
                  <span class="w-1.5 h-1.5 bg-white/40 rounded-full animate-bounce-dot"></span>
                  <span class="w-1.5 h-1.5 bg-white/40 rounded-full animate-bounce-dot" style="animation-delay: 0.15s"></span>
                  <span class="w-1.5 h-1.5 bg-white/40 rounded-full animate-bounce-dot" style="animation-delay: 0.3s"></span>
                </div>
              </div>
            </div>
            <!-- SafetyTAP response -->
            <div id="chat-response" class="flex justify-start opacity-0 transition-opacity duration-500 ease-in-out">
              <div class="bg-white/10 text-white/90 rounded-xl rounded-bl-sm px-4 py-2 text-sm max-w-[260px]">
                <span id="chat-response-text"></span>
                <p id="chat-tip" class="mt-2 text-white/60 text-xs opacity-0 transition-opacity duration-500"></p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 2: The Problem — #3: Dark background treatment -->
  <section class="py-16 md:py-24 bg-[#1a1f2e]" data-animate data-stagger-delay="0.1">
    <div class="max-w-3xl mx-auto px-6">
      <p class="text-sm font-semibold tracking-widest uppercase text-teal mb-3" data-stagger>The Problem</p>
      <h2 class="font-display text-3xl md:text-4xl font-bold text-white leading-tight tracking-tight" data-stagger>Your safety program creates compliance. It doesn't create competence.</h2>
      <div class="mt-8 space-y-4 text-lg text-white/80 leading-relaxed">
        <p data-stagger>Your crew fills out JHAs because they have to. They sit through toolbox talks because it's on the schedule. They check the boxes on the observation card because someone's counting. None of it changes how they actually see hazards when they're standing in front of the task.</p>
        <p data-stagger>The problem isn't the people. Every safety observation program on the market was designed to document compliance, not develop hazard recognition. They assume the worker already knows what to look for. Most of the time, that assumption is wrong.</p>
        <p data-stagger>It's not that your program is bad. It's that the problem is deeper than any program can reach.</p>
      </div>
    </div>
  </section>

  <!-- Section 3: The Insight -->
  <section class="py-16 md:py-24 bg-teal-pale" data-animate data-stagger-delay="0.1">
    <div class="max-w-3xl mx-auto px-6">
      <p class="text-sm font-semibold tracking-widest uppercase text-teal mb-3" data-stagger>Our Approach</p>
      <h2 class="font-display text-3xl md:text-4xl font-bold text-navy leading-tight tracking-tight" data-stagger>Hazard recognition isn't a checklist. It's a skill.</h2>
      <div class="mt-8 space-y-4 text-lg text-dark/80 leading-relaxed">
        <p data-stagger>Experienced workers develop what the industry calls "the eye" — the ability to walk onto a site and immediately spot what's off. It's not magic. It's hazard identification skills built through years of exposure and mentoring from people who know what matters.</p>
        <p data-stagger>SafetyTAP accelerates that process. Like scaffolding on a building — you erect it to support the work, and you take it down when the structure can stand on its own.</p>
      </div>
      <blockquote class="relative pl-8 py-2 my-8 border-l-4 border-teal" data-stagger>
        <span class="absolute -left-1 -top-3 text-5xl text-teal/20 font-serif leading-none select-none">"</span>
        <p class="text-lg md:text-xl italic font-medium text-navy leading-relaxed">A worker who stops using SafetyTAP because they no longer need it is our greatest success.</p>
      </blockquote>
    </div>
  </section>

  <!-- Section 4: How It Works — #4: Large step numbers + connector -->
  <section id="how-it-works" class="py-16 md:py-24 bg-white" data-animate data-stagger-delay="0.15">
    <div class="max-w-5xl mx-auto px-6">
      <p class="text-sm font-semibold tracking-widest uppercase text-teal mb-3 text-center" data-stagger>How It Works</p>
      <h2 class="font-display text-3xl md:text-4xl font-bold text-navy text-center leading-tight tracking-tight" data-stagger>30 seconds. One text. Zero friction.</h2>
      <div class="mt-12 relative">
        <!-- Connector line between steps (desktop only) -->
        <div class="hidden md:block absolute top-[1.5rem] left-[20%] right-[20%] h-px bg-teal/20 z-0"></div>
        <div class="grid md:grid-cols-3 gap-8 relative z-10">
          <div class="text-center" data-stagger>
            <p class="text-[3rem] font-extrabold text-teal/60 font-display leading-none select-none">01</p>
            <h3 class="text-lg font-semibold leading-snug text-navy mt-3">Take a photo</h3>
            <p class="text-dark/70 mt-2 text-base leading-relaxed">Worker snaps a photo of their task or work area. Takes 5 seconds.</p>
          </div>
          <div class="text-center" data-stagger>
            <p class="text-[3rem] font-extrabold text-teal/60 font-display leading-none select-none">02</p>
            <h3 class="text-lg font-semibold leading-snug text-navy mt-3">Send it to SafetyTAP</h3>
            <p class="text-dark/70 mt-2 text-base leading-relaxed">Text the photo to SafetyTAP on Telegram. No app to download, no account to create.</p>
          </div>
          <div class="text-center" data-stagger>
            <p class="text-[3rem] font-extrabold text-teal/60 font-display leading-none select-none">03</p>
            <h3 class="text-lg font-semibold leading-snug text-navy mt-3">Get one specific observation</h3>
            <p class="text-dark/70 mt-2 text-base leading-relaxed">In seconds, SafetyTAP responds with one thing to check — the kind of observation an experienced safety pro would make standing next to you.</p>
          </div>
        </div>
      </div>
      <p class="text-center text-dark/60 mt-8 text-base leading-relaxed">No app to download. No account to create. No training required. Just text the number.</p>
    </div>
  </section>

  <!-- Section 5: The Science — #5: Permanent left accent + hover bg wash -->
  <section class="py-16 md:py-24 bg-light" data-animate data-stagger-delay="0.12">
    <div class="max-w-5xl mx-auto px-6">
      <p class="text-sm font-semibold tracking-widest uppercase text-teal mb-3 text-center" data-stagger>The Science</p>
      <h2 class="font-display text-3xl md:text-4xl font-bold text-navy text-center leading-tight tracking-tight" data-stagger>The science behind better hazard recognition</h2>
      <div class="mt-12 grid md:grid-cols-2 gap-8">
        <div class="bg-white border border-gray-100 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300 ease-in-out group border-l-[3px] border-l-teal hover:bg-teal/[0.04]" data-stagger>
          <h3 class="text-base font-semibold text-navy mb-2 group-hover:text-teal transition-colors">Inattentional Blindness</h3>
          <p class="text-sm text-dark/70 leading-relaxed">Workers focused on their task literally cannot see hazards outside their focus area — the brain filters them out. SafetyTAP breaks that tunnel vision with one targeted observation before the task begins.</p>
        </div>
        <div class="bg-white border border-gray-100 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300 ease-in-out group border-l-[3px] border-l-teal hover:bg-teal/[0.04]" data-stagger>
          <h3 class="text-base font-semibold text-navy mb-2 group-hover:text-teal transition-colors">Self-Efficacy</h3>
          <p class="text-sm text-dark/70 leading-relaxed">Workers who believe their actions can prevent incidents engage in more proactive safety behavior. Confidence drives competence. Each SafetyTAP interaction builds that confidence through specific, actionable feedback.</p>
        </div>
        <div class="bg-white border border-gray-100 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300 ease-in-out group border-l-[3px] border-l-teal hover:bg-teal/[0.04]" data-stagger>
          <h3 class="text-base font-semibold text-navy mb-2 group-hover:text-teal transition-colors">Normalcy Bias</h3>
          <p class="text-sm text-dark/70 leading-relaxed">When unsafe conditions persist without incident, the brain reclassifies them as normal. "We've always done it this way" is the result. SafetyTAP surfaces what familiarity has made invisible.</p>
        </div>
        <div class="bg-white border border-gray-100 rounded-xl p-6 shadow-sm hover:shadow-md transition-all duration-300 ease-in-out group border-l-[3px] border-l-teal hover:bg-teal/[0.04]" data-stagger>
          <h3 class="text-base font-semibold text-navy mb-2 group-hover:text-teal transition-colors">Bystander Effect</h3>
          <p class="text-sm text-dark/70 leading-relaxed">The larger the crew, the less likely anyone is to speak up about a concern. SafetyTAP is a private channel that removes the social cost.</p>
        </div>
      </div>
      <p class="text-center mt-8">
        <a href="/blog" class="text-teal hover:text-teal-light font-medium underline-offset-2 hover:underline transition-colors">Read: Why Workers Miss Hazards — And What Actually Helps</a>
      </p>
    </div>
  </section>

  <!-- Section 6: What Makes It Different — #6: Comparison table added -->
  <section class="py-16 md:py-24 bg-white" data-animate data-stagger-delay="0.1">
    <div class="max-w-3xl mx-auto px-6">
      <p class="text-sm font-semibold tracking-widest uppercase text-teal mb-3" data-stagger>What's Different</p>
      <h2 class="font-display text-3xl md:text-4xl font-bold text-navy leading-tight tracking-tight" data-stagger>Not another program. A practice.</h2>
      <div class="mt-8 space-y-4 text-lg text-dark/80 leading-relaxed">
        <p data-stagger>Every safety observation program on the market does one of two things: automates compliance documentation or provides a digital checklist. SafetyTAP does neither.</p>
        <p data-stagger>Observation platforms assume the worker already knows what to look for. Training platforms deliver content disconnected from the task. Wearables monitor the environment on the worker's behalf — zero cognitive development.</p>
        <p data-stagger>SafetyTAP is the only hazard recognition training that operates at the individual cognitive level, at the point of task, with zero friction. The output isn't a report or a compliance record. The output is a worker who's better at their job tomorrow than they were today.</p>
      </div>

      <!-- Comparison table -->
      <div class="mt-12 max-w-[700px] mx-auto overflow-x-auto" data-stagger>
        <table class="w-full text-sm">
          <thead>
            <tr class="bg-teal/[0.06]">
              <th class="text-left py-3 px-4 font-medium text-dark/50 rounded-tl-lg"></th>
              <th class="text-center py-3 px-4 font-medium text-dark/50">Other Platforms</th>
              <th class="text-center py-3 px-4 font-semibold text-teal rounded-tr-lg">SafetyTAP</th>
            </tr>
          </thead>
          <tbody class="text-dark/80">
            <tr class="border-b border-gray-100/80">
              <td class="py-3 px-4">Works at point of task</td>
              <td class="py-3 px-4 text-center text-[#e05a5a] text-lg">✗</td>
              <td class="py-3 px-4 text-center text-teal text-lg">✓</td>
            </tr>
            <tr class="border-b border-gray-100/80">
              <td class="py-3 px-4">Requires app download</td>
              <td class="py-3 px-4 text-center text-[#e05a5a] text-lg">✓</td>
              <td class="py-3 px-4 text-center text-teal text-lg">✗</td>
            </tr>
            <tr class="border-b border-gray-100/80">
              <td class="py-3 px-4">Builds cognitive skill</td>
              <td class="py-3 px-4 text-center text-[#e05a5a] text-lg">✗</td>
              <td class="py-3 px-4 text-center text-teal text-lg">✓</td>
            </tr>
            <tr class="border-b border-gray-100/80">
              <td class="py-3 px-4">Zero friction to start</td>
              <td class="py-3 px-4 text-center text-[#e05a5a] text-lg">✗</td>
              <td class="py-3 px-4 text-center text-teal text-lg">✓</td>
            </tr>
            <tr class="border-b border-gray-100/80">
              <td class="py-3 px-4">Output is worker improvement</td>
              <td class="py-3 px-4 text-center text-[#e05a5a] text-lg">✗</td>
              <td class="py-3 px-4 text-center text-teal text-lg">✓</td>
            </tr>
            <tr>
              <td class="py-3 px-4">Generates compliance reports</td>
              <td class="py-3 px-4 text-center text-dark/40 text-lg">✓</td>
              <td class="py-3 px-4 text-center text-dark/40 text-lg">✗</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Section 7: Bottom CTA -->
  <section class="relative py-24 md:py-32 text-white overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-navy-deep via-navy to-navy-mid pointer-events-none"></div>
    <div class="relative z-10 max-w-3xl mx-auto px-6">
      <p class="text-sm font-semibold tracking-widest uppercase text-teal mb-3">Get Started</p>
      <h2 class="font-display text-3xl md:text-4xl font-bold leading-tight tracking-tight">Give your crew a tool they'll actually use.</h2>
      <div class="mt-8 space-y-4 text-lg text-white/80 leading-relaxed">
        <p>Your people aren't going to download another app. They're not going to sit through another training module and pretend to pay attention. But they will text a photo — because it takes 10 seconds and gives them something useful back.</p>
        <p>SafetyTAP gives you a leading indicator that actually leads. Not "observations completed," but actual cognitive development in the people doing the work.</p>
      </div>

      <!-- [PLACEHOLDER — replace with real customer quote] -->
      <div class="mt-6 border-l-2 border-teal/40 pl-4">
        <p class="text-white/60 text-sm italic">"Within two weeks, our foremen started referencing SafetyTAP observations in their morning huddles — without being asked."</p>
        <p class="text-white/40 text-xs mt-1">— [PLACEHOLDER] VP of Operations, Specialty Subcontractor, Southeast</p>
      </div>

      <div class="mt-8">
        <a href="/contact"
           class="inline-flex items-center gap-2 bg-teal hover:bg-teal-light
                  text-white font-semibold text-base
                  px-7 py-3.5 rounded-lg
                  shadow-lg shadow-teal/20
                  transition-all duration-200 hover:shadow-xl hover:shadow-teal/30 hover:-translate-y-0.5">
          Talk to Us About Your Crew
        </a>
      </div>
    </div>
  </section>

  <!-- Section 8: Insights Preview -->
  {posts.length > 0 && (
    <section class="py-16 md:py-24 bg-light" data-animate>
      <div class="max-w-5xl mx-auto px-6">
        <p class="text-sm font-semibold tracking-widest uppercase text-teal mb-3 text-center">Latest Insights</p>
        <h2 class="font-display text-3xl md:text-4xl font-bold text-navy text-center leading-tight tracking-tight">The Science of Seeing</h2>
        <p class="text-center text-dark/60 mt-2 text-base leading-relaxed">Research-backed insights on how workers develop hazard recognition</p>
        <div class="mt-12 grid md:grid-cols-3 gap-8">
          {posts.map((post) => (
            <a href={`/blog/${post.slug}`} class="group bg-white border border-gray-100 rounded-xl overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
              <div class="h-1 bg-gradient-to-r from-teal to-teal-light"></div>
              <div class="p-6">
                <h3 class="text-base font-semibold text-navy group-hover:text-teal transition-colors">{post.data.title}</h3>
                <p class="text-dark/60 text-sm mt-2 leading-relaxed">{post.data.description}</p>
                <p class="text-teal text-sm mt-4 font-medium">{post.data.readTime} read</p>
              </div>
            </a>
          ))}
        </div>
        <p class="text-center mt-8">
          <a href="/blog" class="text-teal hover:text-teal-light font-medium underline-offset-2 hover:underline transition-colors">Read More Safety Research</a>
        </p>
      </div>
    </section>
  )}

  <!-- FAQ Section -->
  <section class="py-16 md:py-24 bg-white" data-animate data-stagger-delay="0.1">
    <div class="max-w-3xl mx-auto px-6">
      <p class="text-sm font-semibold tracking-widest uppercase text-teal mb-3 text-center" data-stagger>Common Questions</p>
      <h2 class="font-display text-3xl md:text-4xl font-bold text-navy text-center leading-tight tracking-tight" data-stagger>Frequently Asked Questions</h2>
      <div class="mt-12 space-y-8">
        <div class="border-b border-gray-100 pb-6" data-stagger>
          <h3 class="text-lg font-semibold text-navy">How is SafetyTAP different from a safety app?</h3>
          <p class="text-dark/70 mt-3 leading-relaxed">Safety apps digitize paperwork — JHAs, observation cards, incident reports. They document compliance. SafetyTAP develops a skill. Workers text a photo and get back one specific observation that trains them to see hazards they were missing. The output isn't a form. It's a worker who gets better every day.</p>
        </div>
        <div class="border-b border-gray-100 pb-6" data-stagger>
          <h3 class="text-lg font-semibold text-navy">Does it require training to set up?</h3>
          <p class="text-dark/70 mt-3 leading-relaxed">No. Workers text a photo to a number on Telegram. There is no app to download, no account to create, no login to remember. Setup takes under a minute. If your crew can send a text message, they can use SafetyTAP.</p>
        </div>
        <div class="border-b border-gray-100 pb-6" data-stagger>
          <h3 class="text-lg font-semibold text-navy">What industries is SafetyTAP designed for?</h3>
          <p class="text-dark/70 mt-3 leading-relaxed">SafetyTAP was built for construction — general contractors, specialty subs, and industrial facilities where hazard recognition at the point of task matters most. The system understands scaffolding, excavation, electrical work, confined spaces, and dozens of other construction-specific scenarios.</p>
        </div>
        <div class="border-b border-gray-100 pb-6" data-stagger>
          <h3 class="text-lg font-semibold text-navy">How do workers actually use it on the job site?</h3>
          <p class="text-dark/70 mt-3 leading-relaxed">Before starting a task, a worker snaps a photo of their work area and texts it to SafetyTAP. Within seconds, they get back one specific observation — something in the photo they probably haven't considered. The whole interaction takes about 30 seconds. No forms, no checklists, no supervisor involved.</p>
        </div>
        <div class="border-b border-gray-100 pb-6" data-stagger>
          <h3 class="text-lg font-semibold text-navy">What does the AI actually tell workers?</h3>
          <p class="text-dark/70 mt-3 leading-relaxed">SafetyTAP delivers one brief, specific observation grounded in the photo the worker sent — not a generic checklist, not a warning label. It might point out that wind loads increase faster than expected above grade, or that a particular material combination creates a slip hazard in morning dew. The kind of thing a seasoned safety pro would mention in passing.</p>
        </div>
        <div data-stagger>
          <h3 class="text-lg font-semibold text-navy">Is SafetyTAP a compliance tool or a training tool?</h3>
          <p class="text-dark/70 mt-3 leading-relaxed">Neither, exactly. Compliance tools document what happened. Training tools deliver content in a classroom. SafetyTAP builds a cognitive skill at the point of task — hazard recognition that develops over 2-4 weeks of daily use. It gives safety managers a leading indicator that actually measures whether workers are getting better at seeing risk, not just completing forms.</p>
        </div>
      </div>
    </div>
  </section>

</Base>

<script>
  // ===== #1: Animated Chat Conversation =====
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const sleep = (ms) => new Promise(r => setTimeout(r, ms));

  const WORKER_MSG = 'setting up scaffolding on the second floor, checking connections';
  const RESPONSE_MSG = 'Connections look solid. Wind forecast for this afternoon is worth checking \u2014 standing scaffold above grade catches more lateral load than most people expect from a 15 mph gust.';
  const TIP_MSG = 'Wind loads climb fast above ground level.';

  async function runChatLoop() {
    const workerEl = document.getElementById('chat-worker');
    const workerText = document.getElementById('chat-worker-text');
    const cursor = document.getElementById('chat-cursor');
    const typingEl = document.getElementById('chat-typing');
    const responseEl = document.getElementById('chat-response');
    const responseText = document.getElementById('chat-response-text');
    const tipEl = document.getElementById('chat-tip');

    if (!workerEl) return;

    // If reduced motion, show static content and stop
    if (prefersReducedMotion) {
      workerText.textContent = WORKER_MSG;
      cursor.style.display = 'none';
      workerEl.classList.remove('opacity-0');
      responseText.textContent = RESPONSE_MSG;
      responseEl.classList.remove('opacity-0');
      tipEl.textContent = TIP_MSG;
      tipEl.classList.remove('opacity-0');
      return;
    }

    while (true) {
      // Reset
      workerEl.classList.add('opacity-0');
      workerText.textContent = '';
      cursor.style.display = 'inline-block';
      typingEl.classList.add('opacity-0');
      responseEl.classList.add('opacity-0');
      responseText.textContent = '';
      tipEl.textContent = '';
      tipEl.classList.add('opacity-0');

      await sleep(1000);

      // Worker message types in
      workerEl.classList.remove('opacity-0');
      for (let i = 0; i < WORKER_MSG.length; i++) {
        workerText.textContent += WORKER_MSG[i];
        await sleep(35);
      }
      cursor.style.display = 'none';

      await sleep(500);

      // Typing indicator
      typingEl.classList.remove('opacity-0');
      await sleep(1500);
      typingEl.classList.add('opacity-0');

      await sleep(300);

      // Response fades in
      responseText.textContent = RESPONSE_MSG;
      responseEl.classList.remove('opacity-0');

      await sleep(800);

      // Tip fades in
      tipEl.textContent = TIP_MSG;
      tipEl.classList.remove('opacity-0');

      // Hold for 3s, then fade out
      await sleep(3000);
      workerEl.classList.add('opacity-0');
      responseEl.classList.add('opacity-0');
      await sleep(800);
    }
  }

  runChatLoop();

  // ===== #2: Scroll-triggered staggered fade-ups =====
  if (!prefersReducedMotion) {
    document.querySelectorAll('[data-animate]').forEach(section => {
      const staggerItems = section.querySelectorAll('[data-stagger]');
      const delay = parseFloat(section.dataset.staggerDelay || '0.1');

      if (staggerItems.length > 0) {
        staggerItems.forEach((item, i) => {
          item.style.transitionDelay = `${i * delay}s`;
          item.classList.add('opacity-0', 'translate-y-5', 'transition-all', 'duration-500', 'ease-out');
        });
      } else {
        // No stagger children — animate the section itself
        section.classList.add('opacity-0', 'translate-y-5', 'transition-all', 'duration-700', 'ease-out');
      }
    });

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          const staggerItems = e.target.querySelectorAll('[data-stagger]');
          if (staggerItems.length > 0) {
            staggerItems.forEach(item => {
              item.classList.remove('opacity-0', 'translate-y-5');
            });
          } else {
            e.target.classList.remove('opacity-0', 'translate-y-5');
          }
          observer.unobserve(e.target);
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('[data-animate]').forEach(el => observer.observe(el));
  }
</script>
